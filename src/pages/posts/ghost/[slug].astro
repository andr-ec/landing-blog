---
import BlogPost from "@/layouts/BlogPost";
import ghost from "@/ghost";
import { ghostToSimplePost } from "@/util";
// https://stackblitz.com/edit/github-scvgee?file=src%2Fpages%2Findex.astro
import { Markup } from "astro-remote";
import { components, sanitize } from "src/components/base/components";

export async function getStaticPaths() {
	const ghostPosts = await ghost.posts
		.browse({ limit: 5, include: "tags,authors", filter: "author:andre" })
		.then((p) => {
			return p.map(ghostToSimplePost);
		});

	const paths = ghostPosts.map((post) => {
		return {
			params: { slug: post.slug },
			props: { post },
		};
	});
	return paths;
}
const { slug } = Astro.params;
const postContent = await ghost.posts.read(
	{ slug },
	{ formats: ["html", "plaintext"] }
);
// const turndownService = new TurndownService({codeBlockStyle: 'fenced', headingStyle: 'atx', hr: '---'});
// const content = turndownService.turndown(postContent.html);
const { post } = Astro.props;
const blogContent = { ...post, description: undefined };
---

<BlogPost content={blogContent} headings={post.headings}>
	<Markup content={postContent.html} {sanitize} {components} />
</BlogPost>
